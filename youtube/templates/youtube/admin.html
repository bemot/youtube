{% extends 'youtube/base.html' %}

{% block content %}

<div class="row">
    <div class="col-md-6">
        <h3>Manage channels</h3>
    </div>
    <div class="col-md-6 text-right">

        <form method="POST" action="{% url 'channel-add' %}"
              class="form form-inline add-channel-form inline">
            {% csrf_token %}
            <div class="input-group">
                <input type="text" class="form-control input-sm" name="{{ form.channel.html_name }}"
                       id="form.channel.auto_id }}" value="{{ form.channel.value|default:'' }}"
                       {% if request.method == 'POST' %}autofocus{% endif %}
                       placeholder="URL to author name" />
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-primary btn-sm">
                        <i class="glyphicon glyphicon-plus"></i>
                        Add channel
                    </button>
                </span>
            </div>
            {% if form.channel.errors %}
            <div class="help-block">
                {{ form.channel.errors.0 }}
            </div>
            {% endif %}
        </form>
    </div>
</div>


{% if admin_channels %}
<table class="table table-condensed">
    <thead>
        <tr>
            <th></th>
            <th>Channel</th>
            <th>Number of videos</th>
            <th>First seen</th>
            <th>Last updated</th>
            <th></th>
        </tr>
    </thead>
    {% for channel in admin_channels %}
    <tr{% if channel.hidden %} class="hidden-channel"{% endif %}>
        <td>
            {% if channel.thumbnail %}
            <img class="channel-thumbnail" src="{{ channel.thumbnail }}" />
            {% endif %}
        </td>
        <td>
            <a href="{{ channel.url }}">
                {{ channel.title }}
            </a>
        </td>
        <td>
            {{ channel.videos.all|length }}
        </td>
        <td>
            {{ channel.created|date }}
        </td>
        <td>
            {{ channel.updated|timesince }} ago
        </td>
        <td class="text-right">
            <form class="form form-inline inline" method="POST"
                action="{% url 'toggle-hidden' channelid=channel.pk %}">
                {% csrf_token %}
                {% if channel.hidden %}
                <button class="btn btn-xs btn-success">
                    <i class="glyphicon glyphicon-eye-open"></i>
                    Show channel
                </button>
                {% else %}
                <button class="btn btn-xs btn-warning">
                    <i class="glyphicon glyphicon-eye-close"></i>
                    Hide channel
                </button>
                {% endif %}
            </form>
            <form class="form form-inline inline" method="POST"
                action="{% url 'channel-full-fetch' channelid=channel.pk %}">
                {% csrf_token %}
                <button class="btn btn-xs btn-info" title="Does a full fetch of all videos on the channel">
                    <i class="glyphicon glyphicon-refresh"></i>
                    Full update
                </button>
            </form>
            <form class="form form-inline inline" method="POST"
                action="{% url 'channel-delete' channelid=channel.pk %}">
                {% csrf_token %}
                <button class="btn btn-xs btn-danger" onclick="return confirm('Are you sure you want to remove the channel ?')">
                    <i class="glyphicon glyphicon-trash"></i>
                    Remove
                </button>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<div class="alert alert-warning">
    There are no channels in the system.
</div>
{% endif %}
{% endblock %}
